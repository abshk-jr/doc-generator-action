<html><head><title>Other Language Features</title><link href="./styles/style.css" rel="stylesheet"/></head><body class="mw-body" style="height:auto"><h1 class="firstHeading" id="firstHeading">Other Language Features</h1><div id="bodyContent">
<div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2></div>
<ul style="list-style-image:none">
<li><a href="#Special_variables"><span class="tocnumber">1</span> Special variables</a>
<ul style="list-style-image:none">
<li><a href="#$fa,_$fs_and_$fn"><span class="tocnumber">1.1</span> $fa, $fs and $fn</a></li>
<li><a href="#$t"><span class="tocnumber">1.2</span> $t</a></li>
<li><a href="#$vpr,_$vpt,_$vpf_and_$vpd"><span class="tocnumber">1.3</span> $vpr, $vpt, $vpf and $vpd</a></li>
<li><a href="#$preview"><span class="tocnumber">1.4</span> $preview</a></li>
</ul>
</li>
<li><a href="#Echo_Statements"><span class="tocnumber">2</span> Echo Statements</a>
<ul style="list-style-image:none">
<li><a href="#Rounding_examples"><span class="tocnumber">2.1</span> Rounding examples</a></li>
<li><a href="#Small_and_large_Numbers"><span class="tocnumber">2.2</span> Small and large Numbers</a></li>
<li><a href="#HTML"><span class="tocnumber">2.3</span> HTML</a></li>
</ul>
</li>
<li><a href="#Echo_Function"><span class="tocnumber">3</span> Echo Function</a></li>
<li><a href="#Render"><span class="tocnumber">4</span> Render</a></li>
<li><a href="#Surface"><span class="tocnumber">5</span> Surface</a>
<ul style="list-style-image:none">
<li><a href="#Text_file_format"><span class="tocnumber">5.1</span> Text file format</a></li>
<li><a href="#Images"><span class="tocnumber">5.2</span> Images</a></li>
<li><a href="#Examples"><span class="tocnumber">5.3</span> Examples</a></li>
</ul>
</li>
<li><a href="#Search"><span class="tocnumber">6</span> Search</a>
<ul style="list-style-image:none">
<li><a href="#Search_Usage"><span class="tocnumber">6.1</span> Search Usage</a></li>
<li><a href="#Search_Arguments"><span class="tocnumber">6.2</span> Search Arguments</a></li>
<li><a href="#Search_Usage_Examples"><span class="tocnumber">6.3</span> Search Usage Examples</a>
<ul style="list-style-image:none">
<li><a href="#Index_values_return_as_list"><span class="tocnumber">6.3.1</span> Index values return as list</a></li>
<li><a href="#Search_on_different_column;_return_Index_values"><span class="tocnumber">6.3.2</span> Search on different column; return Index values</a></li>
<li><a href="#Search_on_list_of_values"><span class="tocnumber">6.3.3</span> Search on list of values</a></li>
<li><a href="#Search_on_list_of_strings"><span class="tocnumber">6.3.4</span> Search on list of strings</a></li>
<li><a href="#Getting_the_right_results"><span class="tocnumber">6.3.5</span> Getting the right results</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#OpenSCAD_Version"><span class="tocnumber">7</span> OpenSCAD Version</a></li>
<li><a href="#parent_module(n)_and_$parent_modules"><span class="tocnumber">8</span> parent_module(n) and $parent_modules</a></li>
<li><a href="#assert"><span class="tocnumber">9</span> assert</a>
<ul style="list-style-image:none">
<li><a href="#Example"><span class="tocnumber">9.1</span> Example</a></li>
<li><a href="#Checking_parameters"><span class="tocnumber">9.2</span> Checking parameters</a></li>
<li><a href="#Adding_message"><span class="tocnumber">9.3</span> Adding message</a></li>
<li><a href="#Using_assertions_in_function"><span class="tocnumber">9.4</span> Using assertions in function</a></li>
</ul>
</li>
</ul>
</div>

<h3>Special variables</h3>
<p>Special variables provide an alternate means of passing arguments to modules and functions.
All user, or OpenSCAD, defined variables starting with a '$' are special variables, similar to special variables in lisp.
Modules and function see all outside variables in addition to those passed as arguments or defined internally.
</p><p>The value for a regular variable is assigned at compile time and is thus static for all calls.
</p><p>Special variables pass along their value from within the scope 
<a href="The_OpenSCAD_Language.html#Scope_of_variables" title="OpenSCAD User Manual/The OpenSCAD Language"> (see scope of variables)</a>
from which the module or function is called. 
This means that special variables can potentially have a different value each time a module or function is called.
</p>
<pre>regular  = "regular global";
$special = "special global";
module show() echo("         in show    ", regular,"   ", $special );

echo ("         outside    ", regular,"   ", $special );
          // ECHO: "         outside    ", "regular global", "   ", "special global"
  
for ( regular = [0:1] ){ echo("in regular loop     ", regular,"   ", $special ); show();}
          // ECHO: "in regular loop     ", 0, "   ", "special global"
          // ECHO: "         in show    ", "regular global", "   ", "special global"
          // ECHO: "in regular loop     ", 1, "   ", "special global"
          // ECHO: "         in show    ", "regular global", "   ", "special global"

for ( $special = [5:6] ){ echo("in special loop     ", regular,"   ", $special ); show();}
          // ECHO: "in special loop     ", "regular global", "   ", 5
          // ECHO: "         in show    ", "regular global", "   ", 5
          // ECHO: "in special loop     ", "regular global", "   ", 6
          // ECHO: "         in show    ", "regular global", "   ", 6

show();
          // ECHO: "         in show    ", "regular global", "   ", "special global"
</pre>
<p>This is useful when multiple arguments need to be passed thru several layers of module calls.
</p><p>Several special variables are already defined by OpenSCAD.
</p><p><br/>
</p>
<h4>$fa, $fs and $fn</h4>
<p>The $fa, $fs and $fn special variables control the number of facets used to
generate an arc:
</p><p>$fa is the minimum angle for a fragment. Even a huge circle does not have
more fragments than 360 divided by this number. The default value is 12 (i.e. 30 fragments
for a full circle). The minimum allowed value is 0.01. Attempting to set a lower value causes a warning.
</p><p>$fs is the minimum size of a fragment. The
default value is 2 so very small circles have a smaller number of fragments than specified using $fa. The minimum allowed value is 0.01. Attempting to set a lower value causes a warning.
</p><p>$fn is usually the default value of 0. When this variable has a value greater than zero, the
other two variables are ignored, and a full circle is rendered using this
number of fragments.
</p><p>The higher the number of fragments, the more memory and CPU consumed; large values can bring many systems to their knees. Depending on the design, $fn values, and the corresponding results of $fa &amp; $fs,  should be kept small, at least until the design is finalised when it can be increased for the final result. <b>A $fn over 100 is not recommended</b> or only for specific circumstances, and below 50 would be advisable for performance.
</p><p><b>TIP:</b> If you want to create a circle/cylinder/sphere which has an axis
aligned integer bounding box (i.e. a bounding box that has
integral dimensions, and an integral position) use a value of $fn that
is divisible by 4.
</p><p><br/>
When $fa and $fs are used to determine the number of fragments for a
circle, then OpenSCAD never uses fewer than 5 fragments.
</p><p>This is the C code that calculates the number of fragments in a circle:
</p>
<pre>      int get_fragments_from_r(double r, double fn, double fs, double fa)
      {
             if (r &lt; GRID_FINE) return 3;
             if (fn &gt; 0.0) return (int)(fn &gt;= 3 ? fn : 3);
             return (int)ceil(fmax(fmin(360.0 / fa, r*2*M_PI / fs), 5));
      }
</pre>
<p>Or you can embed this OpenSCAD version in your code to work out what's going on, you need to set r= to your size
</p>
<pre>   echo(n=($fn&gt;0?($fn&gt;=3?$fn:3):ceil(max(min(360/$fa,r*2*PI/$fs),5))),a_based=360/$fa,s_based=r*2*PI/$fs);
</pre>
<p>Spheres are first sliced into as many slices as the number of fragments being used
to render a circle of the sphere's radius, and then every slice is rendered
into as many fragments as are needed for the slice radius. You might have
recognized already that the pole of a sphere is usually a pentagon. This is
why.
</p><p>The number of fragments for a cylinder is determined using the greater of
the two radii.
</p><p>The method is also used when rendering circles and arcs from DXF files. The
variables have no effect when importing STL files.
</p><p>You can generate high resolution spheres by resetting the $fX values in
the instantiating module:
</p>
<pre>      $fs = 0.01;
      sphere(2);
</pre>
<p>or simply by passing the special variable as parameter:
</p>
<pre>      sphere(2, $fs = 0.01);
</pre>
<p>You can even scale the special variable instead of resetting it:
</p>
<pre>      sphere(2, $fs = $fs * 0.01);
</pre>
<h4>$t</h4>
<p>The $t variable is used for animation. If you enable the animation frame with view-&gt;animate and give a value for "FPS" and "Steps", the "Time" field shows the current value of $t. With this information in mind, you can animate your design. The design is recompiled every 1/"FPS" seconds with $t incremented by 1/"Steps" for "Steps" times, ending at either $t=1 or $t=1-1/steps.  
</p><p>If "Dump Pictures" is checked, then images are created in the same directory as the .scad file, using the following $t values, and with the following naming convention:
</p><p>Naming Convention
</p>
<hr/>
<p>Pattern 1:
</p>
<ul style="list-style-image:none"><li>$t=0/Steps filename="frame00001.png"</li>
<li>$t=1/Steps filename="frame00002.png</li>
<li>$t=2/Steps filename="frame00003.png"</li>
<li>. . .</li>
<li>$t=1-3/Steps filename="frame&lt;Steps-2&gt;.png"</li>
<li>$t=1-2/Steps filename="frame&lt;Steps-1&gt;.png"</li>
<li>$t=1-1/Steps filename="frame00000.png"</li></ul>
<p>Or, for other values of Steps, it follows this pattern:
</p><p>Pattern2:
</p>
<ul style="list-style-image:none"><li>$t=0/Steps filename="frame00001.png"</li>
<li>$t=1/Steps filename="frame00002.png</li>
<li>$t=2/Steps filename="frame00003.png"</li>
<li>. . .</li>
<li>$t=1-3/Steps filename="frame&lt;Steps-2&gt;.png"</li>
<li>$t=1-2/Steps filename="frame&lt;Steps-1&gt;.png"</li>
<li>$t=1-1/Steps filename="frame&lt;Steps-0&gt;.png"</li>
<li>$t=1-0/Steps filename="frame00000.png"</li></ul>
<p>Which pattern it chooses appears to be an unpredictable, but consistent determined by Steps.  For example, when Steps=4, it follows the first pattern, and outputs a total of 4 files.  When Steps=3, it follows the second pattern, and also outputs 4 files.  It always outputs either Steps or Steps+1 files, though it may not be predictable which.  When finished, it wraps around and recreate each of the files, looping through and recreating them forever.
</p>
<h4>$vpr, $vpt, $vpf and $vpd</h4>
<p>These contain the current viewport rotation and translation and camera distance - at the time of doing the rendering. Moving the viewport does not update them. During an animation they are updated for each frame.
</p>
<ul style="list-style-image:none"><li>$vpr shows rotation</li>
<li>$vpt shows translation (i.e. won't be affected by rotate and zoom)</li>
<li>$vpf shows the FOV of the view <span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2021.01</span></span>]</span></li>
<li>$vpd shows the camera distance <span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2015.03</span></span>]</span></li></ul>
<p>Example
</p>
<pre> cube([10, 10, $vpr[0] / 10]);
</pre>
<p>which makes the cube change size based on the view angle, if an animation loop is active (which does not need to use the $t variable)
</p><p>You can also make bits of a complex model vanish as you change the view.
</p><p>All three variables are writable, but only assignments at the top-level of the main file has an effect on the viewport. <span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2015.03</span></span>]</span>
</p><p>Example
</p>
<pre> $vpr = [0, 0, $t * 360];
</pre>
<p>which allows a simple 360 degree rotation around the Z axis in animation mode.
</p><p>The menu command <i>Edit - Paste Viewport Rotation/Translation</i> copies the current value of the viewport, but not the current $vpr or $vpt.
</p>
<h4>$preview</h4>
<p><span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2019.05</span></span>]</span>
</p><p>$preview is true, when in OpenCSG preview (F5). $preview is false, when in render (F6).
</p><p>This can, for example, be used to reduce detail during preview to save time, without losing detail in the final rendered result:
</p>
<pre>$fn = $preview ? 12 : 72;
sphere(r = 1);
</pre>
<p>Note that the render module does not affect $preview:
</p>
<pre>render(){
    $fn = $preview ? 12 : 72;
    sphere(r = 1);
}
</pre>
<p>Another use could be to make the preview show an assembly view and the render generate just the printed parts laid out for printing.
</p><p>If printed parts need extra features that are removed post printing, for example support for suspended holes, then the preview can omit these to show the finished part after post processing.
</p><p>When OpenSCAD is run from the command line $preview is only true when generating a PNG image with OpenCSG. It is false when generating STL, DXF and SVG files with CGAL. It is also false when generating CSG and ECHO files. This may or may not be what you want, but you can always override it on the command line like any other variable with the -D option.
</p>
<h3>Echo Statements</h3>
<p>This function prints the contents to the compilation window (aka Console).  Useful for debugging code. Also see the String function <a href="String_Functions.html#str" title="OpenSCAD User Manual/String Functions">str()</a>.
</p><p>Numeric values are rounded to 5 significant digits.
</p><p>It can be handy to use 'variable=variable' as the expression to easily label the variables, see the example below.
</p><p><b>Usage examples:</b>
</p>
<pre>my_h=50;
my_r=100;
echo("This is a cylinder with h=", my_h, " and r=", my_r);
echo(my_h=my_h,my_r=my_r); // shortcut
cylinder(h=my_h, r=my_r);
</pre>
<p>Shows in the Console as
</p>
<pre>ECHO: "This is a cylinder with h=", 50, " and r=", 100
ECHO: my_h = 50, my_r = 100
</pre>
<p>Note that the output will not have the extra double quotes and commas if converted to a string using str().
</p>
<h4>Rounding examples</h4>
<p>An example for the rounding:
</p>
<pre>a=1.0;
b=1.000002;
echo(a);
echo(b);

if(a==b){ //while echoed the same, the values are still distinct 
    echo ("a==b");
}else if(a&gt;b){
    echo ("a&gt;b");
}else if(a&lt;b){
    echo ("a&lt;b");
}else{
    echo ("???");
}
</pre>
<h4>Small and large Numbers</h4>
<pre>c=1000002;
d=0.000002;
echo(c); //1e+06
echo(d); //2e-06
</pre>
<h4>HTML</h4>
<p>HTML output is not officially supported, however depending on the OpenSCAD version, some HTML tags were rendered in the console window.
</p>
<h3>Echo Function</h3>
<p><span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2019.05</span></span>]</span>
</p><p>Echo can be used in expression context to print information while the function/expression is evaluated. The output is generated before the expression evaluation to allow debugging of recursive functions. 
</p><p><b>Example</b>
</p>
<pre> a = 3; b = 5;
 
 // echo() prints values before evaluating the expression
 r1 = echo(a, b) a * b; // ECHO: 3, 5
 
 // using let it's still easy to output the result
 r2 = let(r = 2 * a * b) echo(r) r; // ECHO: 30
 
 // use echo statement for showing results 
 echo(r1, r2); // ECHO: 15, 30
</pre>
<p>A more complex example shows how echo() can be used in both descending and ascending path of a recursive function. The result() helper function is a simple way to output the value of an expression after evaluation.
</p><p><b>Example printing both input values and result of recursive sum()</b>
</p>
<pre> v = [4, 7, 9, 12];
 function result(x) = echo(result = x) x;
 function sum(x, i = 0) = echo(str("x[", i, "]=", x[i])) result(len(x) &gt; i ? x[i] + sum(x, i + 1) : 0);
 echo("sum(v) = ", sum(v));
 
 // ECHO: "x[0]=4"
 // ECHO: "x[1]=7"
 // ECHO: "x[2]=9"
 // ECHO: "x[3]=12"
 // ECHO: "x[4]=undef"
 // ECHO: result = 0
 // ECHO: result = 12
 // ECHO: result = 21
 // ECHO: result = 28
 // ECHO: result = 32
 // ECHO: "sum(v) = ", 32
</pre>
<h3>Render</h3>
<p>Forces the generation of a mesh even in preview mode. Useful when the boolean operations become too slow to track.
</p><p>Needs description.
</p><p><b>Usage examples:</b>
</p>
<pre>render(convexity = 2) difference() {
 cube([20, 20, 150], center = true);
 translate([-10, -10, 0])
  cylinder(h = 80, r = 10, center = true);
 translate([-10, -10, +40])
  sphere(r = 10);
 translate([-10, -10, -40])
  sphere(r = 10);
}
</pre>
<h3>Surface</h3>
<p>Surface reads <a class="extiw" href="https://en.wikipedia.org/wiki/Heightmap" title="w:Heightmap">Heightmap</a> information from text or image files.
</p><p><b>Parameters</b>
</p>
<dl><dt>file</dt>
<dd>String. The path to the file containing the heightmap data.</dd></dl>
<dl><dt>center</dt>
<dd>Boolean.  This determines the positioning of the generated object.  If true, object is centered in X- and Y-axis.  Otherwise, the object is placed in the positive quadrant.  Defaults to false.</dd></dl>
<dl><dt>invert</dt>
<dd>Boolean. Inverts how the color values of imported images are translated into height values. This has no effect when importing text data files. Defaults to false. <span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2015.03</span></span>]</span></dd></dl>
<dl><dt>convexity</dt>
<dd>Integer. The convexity parameter specifies the maximum number of front sides (back sides) a ray intersecting the object might penetrate. This parameter is only needed for correctly displaying the object in OpenCSG preview mode and has no effect on the final rendering.</dd></dl>
<h4>Text file format</h4>
<p>The format for text based heightmaps is a matrix of numbers that represent the height for a specific point. Rows are mapped to the Y-axis, columns to the X axis.
The numbers must be separated by spaces or tabs. Empty lines and lines starting with a # character are ignored.
</p>
<h4>Images</h4>
<p><span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2015.03</span></span>]</span>
</p><p>Currently only PNG images are supported. Alpha channel information of the image is ignored and the height for the pixel is determined by converting the color value to <a class="extiw" href="https://en.wikipedia.org/wiki/Grayscale" title="w:Grayscale">Grayscale</a> using the linear luminance for the sRGB color space (Y = 0.2126R + 0.7152G + 0.0722B). The gray scale values are scaled to be in the range 0 to 100.
</p>
<h4>Examples</h4>
<p><b>Example 1:</b>
</p>
<pre>//surface.scad
surface(file = "surface.dat", center = true, convexity = 5);
%translate([0,0,5])cube([10,10,10], center =true);
</pre>
<pre>#surface.dat
10 9 8 7 6 5 5 5 5 5 
9 8 7 6 6 4 3 2 1 0 
8 7 6 6 4 3 2 1 0 0
7 6 6 4 3 2 1 0 0 0
6 6 4 3 2 1 1 0 0 0
6 6 3 2 1 1 1 0 0 0
6 6 2 1 1 1 1 0 0 0
6 6 1 0 0 0 0 0 0 0
3 1 0 0 0 0 0 0 0 0
3 0 0 0 0 0 0 0 0 0
</pre>
<p>Result:
</p><p><a class="image" href="./imgs/Openscad_surface_example_x1.png"><img alt="Openscad surface example x1.png" data-file-height="495" data-file-width="521" decoding="async" height="495" src="./imgs/Openscad_surface_example_x1.png" width="521"/></a>
</p><p><b>Example 2</b>
</p>
<pre> // example010.dat generated using octave:
 // d = (sin(1:0.2:10)' * cos(1:0.2:10)) * 10;
 // save("example010.dat", "d");
 intersection() {
   surface(file = "example010.dat", center = true, convexity = 5);
   rotate(45, [0, 0, 1]) surface(file = "example010.dat", center = true, convexity = 5); 
 }
</pre>
<p><a class="image" href="./imgs/Openscad_surface_example_x2.png"><img alt="Openscad surface example x2.png" data-file-height="366" data-file-width="397" decoding="async" height="366" src="./imgs/Openscad_surface_example_x2.png" width="397"/></a>
</p><p><b>Example 3:</b>
</p><p><span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2015.03</span></span>]</span>
</p>
<pre>// Example 3a
scale([1, 1, 0.1])
  surface(file = "smiley.png", center = true);
</pre>
<pre>// Example 3b
scale([1, 1, 0.1])
  surface(file = "smiley.png", center = true, invert = true);
</pre>
<div class="thumb tmulti tnone center"><div class="thumbinner" style="width:672px;max-width:672px"><div class="trow"><div class="tsingle" style="width:222px;max-width:222px"><div class="thumbimage"><a class="image" href="./imgs/220px-OpenSCAD_surface_example_input_image.png"><img alt="Input image" data-file-height="300" data-file-width="400" decoding="async" height="165" src="./imgs/220px-OpenSCAD_surface_example_input_image.png" width="220"/></a></div><div class="thumbcaption">Input image</div></div><div class="tsingle" style="width:222px;max-width:222px"><div class="thumbimage"><a class="image" href="./imgs/220px-OpenSCAD_surface_example.png"><img alt="Surface output" data-file-height="600" data-file-width="800" decoding="async" height="165" src="./imgs/220px-OpenSCAD_surface_example.png" width="220"/></a></div><div class="thumbcaption">Example 3a: surface(invert = false)</div></div><div class="tsingle" style="width:222px;max-width:222px"><div class="thumbimage"><a class="image" href="./imgs/220px-OpenSCAD_surface_example__28inverted_29.png"><img alt="Surface output inverted" data-file-height="600" data-file-width="800" decoding="async" height="165" src="./imgs/220px-OpenSCAD_surface_example__28inverted_29.png" width="220"/></a></div><div class="thumbcaption">Example 3b: surface (invert = true)</div></div></div><div class="trow" style="display:flex"><div class="thumbcaption">Example 3: Using surface() with a PNG image as heightmap input.</div></div></div></div>
<p><b>Example 4:</b>
</p><p><span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2015.03</span></span>]</span>
</p>
<pre>// Example 4
surface(file = "BRGY-Grey.png", center = true, invert = false);
</pre>
<ul class="gallery mw-gallery-traditional" style="list-style-image:none">
		<li class="gallerybox" style="width: 155px"><div style="width: 155px">
			<div class="thumb" style="width: 150px;"><div style="margin:37.5px auto;"><a class="image" href="./imgs/120px-BRGY-Grey.png"><img alt="" data-file-height="200" data-file-width="320" decoding="async" height="75" src="./imgs/120px-BRGY-Grey.png" width="120"/></a></div></div>
			<div class="gallerytext">
<p>PNG Test File
</p>
			</div>
		</div></li>
		<li class="gallerybox" style="width: 155px"><div style="width: 155px">
			<div class="thumb" style="width: 150px;"><div style="margin:33.5px auto;"><a class="image" href="./imgs/120px-BRGY-Grey-3D.png"><img alt="" data-file-height="416" data-file-width="600" decoding="async" height="83" src="./imgs/120px-BRGY-Grey-3D.png" width="120"/></a></div></div>
			<div class="gallerytext">
<p>3D Surface
</p>
			</div>
		</div></li>
</ul>
<h3>Search</h3>
<p>The search() function is a general-purpose function to find one or more (or all) occurrences of a value or list of values in a vector, string or more complex list-of-list construct.
</p>
<h4>Search Usage</h4>
<dl><dd>search( <i>match_value</i> , <i>string_or_vector</i> [, <i>num_returns_per_match</i> [, <i>index_col_num</i> ] ] );</dd></dl>
<h4>Search Arguments</h4>
<ul style="list-style-image:none"><li><b>match_value</b></li></ul>
<dl><dd><ul style="list-style-image:none"><li>Can be a single string value. Search loops over the characters in the string and searches for each one in the second argument. The second argument must be a string or a list of lists (this second case is not recommended). The search function does <b>not</b> search for substrings.</li>
<li>Can be a single numerical value.</li>
<li>Can be a list of values. The search function searches for each item on the list.</li>
<li>To search for a list or a full string give the list or string as a single element list such as ["abc"] to search for the string "abc" (See <b>Example 9</b>) or [[6,7,8]] to search for the list [6,7,8].  Without the extra brackets, search looks separately for each item in the list.</li>
<li>If match_value is boolean then search returns undef.</li></ul></dd></dl>
<ul style="list-style-image:none"><li><b>string_or_vector</b></li></ul>
<dl><dd><ul style="list-style-image:none"><li>The string or vector to search for matches.</li>
<li>If <b>match_value</b> is a string then this should be a string and the string is searched for individual character matches to the characters in <b>match_value</b></li>
<li>If this is a list of lists, v=[[a0,a1,a2...],[b0,b1,b2,...],[c0,c1,c2,...],...] then search looks only at one index position of the sublists. By default this is position 0, so the search looks only at a0, b0, c0, etc.  The <b>index_col_num</b> parameter changes which index is searched.</li>
<li>If <b>match_value</b> is a string and this parameter is a list of lists then the characters of the string are tested against the appropriate index entry in the list of lists. However, if any characters fail to find a match a warning message is printed and that return value is excluded from the output (if <b>num_returns_per_match</b> is 1). This means that the length of the output is unpredictable.</li></ul></dd></dl>
<ul style="list-style-image:none"><li><b>num_returns_per_match</b> (default: 1)</li></ul>
<dl><dd><ul style="list-style-image:none"><li>By default, search only looks for one match per element of match_value to return as a list of indices</li>
<li>If num_returns_per_match &gt; 1, search returns a list of lists of up to num_returns_per_match index values for each element of match_value.</li></ul>
<dl><dd><ul style="list-style-image:none"><li>See <b>Example 8</b> below.</li></ul></dd></dl>
<ul style="list-style-image:none"><li>If num_returns_per_match = 0, search returns a list of lists of <b>all</b> matching index values for each element of match_value.</li></ul>
<dl><dd><ul style="list-style-image:none"><li>See <b>Example 6</b> below.</li></ul></dd></dl></dd></dl>
<ul style="list-style-image:none"><li><b>index_col_num</b> (default: 0)</li></ul>
<dl><dd><ul style="list-style-image:none"><li>As noted above, when searching a list of lists, search looks only at one index position of each sublist.  That index position is specified by <b>index_col_num</b>.</li>
<li>See <b>Example 5</b> below for a simple usage example.</li></ul></dd></dl>
<h4>Search Usage Examples</h4>
<dl><dd>See <b>example023.scad</b> included with OpenSCAD for a renderable example.</dd></dl>
<h5>Index values return as list</h5>
<table class="wikitable">
<tbody><tr>
<th>Example
</th>
<th>Code
</th>
<th>Result
</th></tr>
<tr>
<td align="center">
<p>1
</p>
</td>
<td>
<p><code>search("a","abcdabcd");</code>
</p>
</td>
<td>
<p>[0]
</p>
</td></tr>
<tr>
<td align="center">
<p>2
</p>
</td>
<td>
<p><code>search("e","abcdabcd");</code>
</p>
</td>
<td>
<p>[]
</p>
</td></tr>
<tr>
<td align="center">
<p>3
</p>
</td>
<td>
<p><code>search("a","abcdabcd",0);</code>
</p>
</td>
<td>
<p>[[0,4]]
</p>
</td></tr>
<tr>
<td align="center">
<p>4
</p>
</td>
<td>
<p><code>data=[ ["a",1],["b",2],["c",3],["d",4],["a",5],["b",6],["c",7],["d",8],["e",9] ];</code>
</p><p><code>search("a", data, <i>num_returns_per_match</i>=0);</code>
</p>
</td>
<td>
<p>[[0,4]] (see also Example 6 below)
</p>
</td></tr></tbody></table>
<h5>Search on different column; return Index values</h5>
<p><b>Example 5:</b>
</p>
<pre> data= [ ["a",1],["b",2],["c",3],["d",4],["a",5],["b",6],["c",7],["d",8],["e",3] ];
 echo(search(3, data));    // Searches index 0, so it doesn't find anything
 echo(search(3, data, <i>num_returns_per_match</i>=0, <i>index_col_num</i>=1));
</pre>
<p>Outputs:
</p>
<pre> ECHO: []
 ECHO: [2, 8]
</pre>
<h5>Search on list of values</h5>
<p><b>Example 6:  Return all matches per search vector element.</b>
</p>
<pre> data= [ ["a",1],["b",2],["c",3],["d",4],["a",5],["b",6],["c",7],["d",8],["e",9] ];
 search("abc", data, num_returns_per_match=0);
</pre>
<p>Returns:
</p>
<pre>   [[0,4],[1,5],[2,6]]
</pre>
<p><b>Example 7:  Return first match per search vector element; special case return vector.</b>
</p>
<pre> data= [ ["a",1],["b",2],["c",3],["d",4],["a",5],["b",6],["c",7],["d",8],["e",9] ];
 search("abc", data, num_returns_per_match=1);
</pre>
<p>Returns:
</p>
<pre>   [0,1,2]
</pre>
<p><b>Example 8:  Return first two matches per search vector element; vector of vectors.</b>
</p>
<pre> data= [ ["a",1],["b",2],["c",3],["d",4],["a",5],["b",6],["c",7],["d",8],["e",9] ];
 search("abce", data, num_returns_per_match=2);
</pre>
<p>Returns:
</p>
<pre> [[0,4],[1,5],[2,6],[8]]
</pre>
<h5>Search on list of strings</h5>
<p><b>Example 9:</b>
</p>
<pre> lTable2=[ ["cat",1],["b",2],["c",3],["dog",4],["a",5],["b",6],["c",7],["d",8],["e",9],["apple",10],["a",11] ];
 lSearch2=["b","zzz","a","c","apple","dog"];
 l2=search(lSearch2,lTable2);
 echo(str("Default list string search (",lSearch2,"): ",l2));
</pre>
<p>Returns
</p>
<pre> ECHO: "Default list string search (["b", "zzz", "a", "c", "apple", "dog"]): [1, [], 4, 2, 9, 3]"
</pre>
<h5>Getting the right results</h5>
<pre>// workout which vectors get the results
v=[ ["O",2],["p",3],["e",9],["n",4],["S",5],["C",6],["A",7],["D",8] ];
//
echo(v[0]);					// -&gt; ["O",2]
echo(v[1]);                                     // -&gt; ["p",3]
echo(v[1][0],v[1][1]);                          // -&gt; "p",3
echo(search("p",v));                            // find "p" -&gt; [1]
echo(search("p",v)[0]);                         // -&gt; 1
echo(search(9,v,0,1));                          // find  9  -&gt; [2] 
echo(v[search(9,v,0,1)[0]]);                    // -&gt; ["e",9]
echo(v[search(9,v,0,1)[0]][0]);                 // -&gt; "e"
echo(v[search(9,v,0,1)[0]][1]);                 // -&gt; 9
echo(v[search("p",v,1,0)[0]][1]);               // -&gt; 3
echo(v[search("p",v,1,0)[0]][0]);               // -&gt; "p"
echo(v[search("d",v,1,0)[0]][0]);               // "d" not found -&gt; undef
echo(v[search("D",v,1,0)[0]][1]);               // -&gt; 8
</pre>
<h3>OpenSCAD Version</h3>
<p>version() and version_num() returns the OpenSCAD version number.
</p>
<ul style="list-style-image:none"><li>The version() function returns the OpenSCAD version as a vector of three numbers, e.g. [2011, 9, 23]</li>
<li>The version_num() function returns the OpenSCAD version as a number, e.g. 20110923</li></ul>
<h3>parent_module(n) and $parent_modules</h3>
<p>$parent_modules contains the number of modules in the instantiation stack.
parent_module(i) returns the name of the module i levels above the current module in the instantiation stack.
The stack is independent of where the modules are defined. It's where they're instantiated that counts.
This can, for example, be used to build a BOM (Bill Of Material).
</p><p>Example:
</p>
<pre> module top() {
   children();
 }
 module middle() {
   children();
 }
 top() middle() echo(parent_module(0)); // prints "middle"
 top() middle() echo(parent_module(1)); // prints "top"
</pre>
<h3>assert</h3>
<p><span style="font-weight: bold; font-style: normal;">[<span style="color: #A00000;">Note:</span> <span style="font-weight: normal; font-style: italic;">Requires version <span style="font-weight: bold;">2019.05</span></span>]</span>
</p><p><i>see also <a class="extiw" href="https://en.wikipedia.org/wiki/Assertion_(software_development)" title="wikipedia:Assertion (software development)">Assertion (software development)</a></i>
</p><p>Assert evaluates a logical expression. If the expression evaluates to false, the generation of the preview/render is stopped, and an error condition is reported via the console.  The report consists of a string representation of the expression and an additional string (optional) that is specified in the assert command.
</p>
<pre> assert(condition);
 assert(condition, message);
</pre>
<p><b>Parameters</b>
</p>
<dl><dt>condition</dt>
<dd>Expression. The expression to be evaluated as check for the assertion.</dd></dl>
<dl><dt>message</dt>
<dd>String. Optional message to be output in case the assertion failed.</dd></dl>
<h4>Example</h4>
<p>The simplest example is a simple <code>assert(false);</code>, e.g. in a file named <code>assert_example1.scad</code>.
</p>
<pre>cube();
assert(false);
sphere();
  
// ERROR: Assertion 'false' failed in file assert_example1.scad, line 2
</pre>
<p>This example has little use, but the simple <code>assert(false);</code> can be used in code sections that should be unreachable.
</p>
<h4>Checking parameters</h4>
<p>A useful example is checking the validity of input parameters:
</p>
<pre>module row(cnt = 3){
    // Count has to be a positive integer greater 0
    assert(cnt &gt; 0);
    for (i = [1 : cnt]) {
        translate([i * 2, 0, 0]) sphere();
    }
}

row(0);

// ERROR: Assertion '(cnt &gt; 0)' failed in file assert_example2.scad, line 3
</pre>
<h4>Adding message</h4>
<p>When writing a library, it could be useful to output additional information to the user in case of an failed assertion.
</p>
<pre>module row(cnt = 3){
    assert(cnt &gt; 0, "Count has to be a positive integer greater 0");
    for(i = [1 : cnt]) {
        translate([i * 2, 0, 0]) sphere();
    }
}

row(0);

// ERROR: Assertion '(cnt &gt; 0)': "Count has to be a positive integer greater 0" failed in file assert_example3.scad, line 2
</pre>
<h4>Using assertions in function</h4>
<p>Assert returns its children, so when using it in a function you can write
</p>
<pre>function f(a, b) =
    assert(a &lt; 0, "wrong a") // assert input
    assert(b &gt; 0, "wrong b") // assert input
    let (c = a + b) // derive a new value from input
    assert(c != 0, "wrong c") // assert derived value
    a * b; // calculate
</pre>




</div><footer class="mw-body" style="font-size:13px;color:darkgray;text-align:center;margin-bottom:-1px">
	From the WikiBooks article <a href="https://en.wikibooks.org/wiki/OpenSCAD_User_Manual/Other_Language_Features" style="color:black">Other Language Features</a> 
	(provided under <a href="https://creativecommons.org/licenses/by-sa/3.0/" style="color:black">
	CC-BY-SA-3.0</a>)</footer></body></html>